import logging
logger = logging.getLogger(__name__)

import streamlit as st
from api.backend.db_connection import db
from modules.nav import SideBarLinks

# Set up the page configuration
st.set_page_config(layout="wide")

# Show appropriate sidebar links for the role of the currently logged in user
SideBarLinks()

# Fetch medication alerts for the doctor
cursor = db.get_db().cursor()
cursor.execute("""
    SELECT p.Name AS PatientName, a.AlertType, a.Message, a.Date
    FROM ALERT a
    JOIN PATIENT p ON a.PatientID = p.PatientID
    WHERE a.AlertType = 'Drug Interaction'
""")

alerts = cursor.fetchall()

st.title(f"Medication Alerts for Dr. {st.session_state['first_name']}")

if alerts:
    for alert in alerts:
        st.write(f"**Patient**: {alert['PatientName']}")
        st.write(f"**Alert Type**: {alert['AlertType']}")
        st.write(f"**Message**: {alert['Message']}")
        st.write(f"**Date**: {alert['Date']}")
        st.write("-" * 50)
else:
    st.write("No medication alerts found.")

# Option to review more details or act on alerts
if st.button("Review Full Medication Interaction Details", type="primary", use_container_width=True):
    st.write("Review the full list of medications and their interactions in the patient database.")
